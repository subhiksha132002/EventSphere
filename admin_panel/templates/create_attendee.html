{% extends "base.html" %} {% load static %}{% block extra_css %}<link
  rel="stylesheet"
  href="{% static 'css/create_user.css' %}"
/>{% endblock %} {% block content %}
<div class="create-event">
  <h3>Create User</h3>
  <form
    id="create-user-form"
    method="post"
    enctype="multipart/form-data"
    action="{% url 'admin_panel:create_user' %}"
  >
    {% csrf_token %}
    <div class="form-group">
      <label for="name">First Name:</label>
      <div class="input-field">
        <!-- added container for input fields -->
        <input type="text" id="name" name="name" required />
      </div>
    </div>
    <div class="form-group">
      <label for="last_name">Last Name:</label>
      <div class="input-field">
        <input type="text" id="last_name" name="last_name" required />
      </div>
    </div>
    <div class="form-group">
      <label for="email">Email:</label>
      <div class="input-field">
        <input type="text" id="name" name="name" required />
      </div>
    </div>
    <div class="form-group">
      <label for="user_type">User Type:</label>
      <div class="input-field">
        <select id="user_type" name="user_type">
          {% for choice in form.fields.user_type.choices %}
          <option value="{{ choice.0 }}">{{ choice.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="form-group">
      <label for="date_time">Date Joined:</label>
      <div class="input-field">
        <input type="datetime-local" id="date_time" name="date_time" required />
      </div>
    </div>
    <div class="form-group">
      <label for="events_attending">Events Registered:</label>
      <div class="input-field">
        <select id="events_attending" name="events_attending" multiple>
          {% for event in events %}
          <option value="{{ event.id }}">{{ event.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <button type="submit" id="submit-btn">Create</button>
  </form>
</div>

<!-- Modal -->
<div id="errorModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p id="errorMessage"></p>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p id="successMessage"></p>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script src="{% static 'js/admin_dashboard.js' %}"></script>
<script>
  document
    .getElementById("create-user-form")
    .addEventListener("submit", function (event) {
      event.preventDefault(); // Prevent the form from submitting normally

      // Send the form data using AJAX
      var formData = new FormData(this);
      fetch("{% url 'admin_panel:create_user' %}", {
        method: "POST",
        body: formData,
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
        },
        credentials: "same-origin",
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((data) => {
              showErrorModal(data.error);
            });
          } else {
            return response.json().then((data) => {
              showSuccessModal(data.success);
            });
          }
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    });
</script>
{% endblock %}
